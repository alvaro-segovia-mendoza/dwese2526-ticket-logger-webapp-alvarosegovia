<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head('Ticket Logger - User Detail')"></head>

<body class="d-flex flex-column h-100">

<!-- Insertar el fragmento del header -->
<header th:replace="fragments/header :: header"></header>

<!-- Contenido dinámico -->
<main class="detail-page">
    <div class="detail-card">

        <br><br>
        <!-- Título con i18n -->
        <h1 th:text="#{msg.user-detail.title}">Detalle del Usuario</h1>

        <!-- Mensaje de error -->
        <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

        <!-- Detalles del usuario -->
        <table class="table table-bordered table-striped mt-3">
            <tbody>
            <tr>
                <th th:text="#{msg.user-detail.id}">ID</th>
                <td th:text="${user.id}"></td>
            </tr>
            <tr>
                <th th:text="#{msg.user-detail.email}">Email</th>
                <td th:text="${user.email}"></td>
            </tr>
            <tr>
                <th th:text="#{msg.user-detail.active}">Activo</th>
                <td th:text="${user.active} ? 'Sí' : 'No'"></td>
            </tr>
            <tr>
                <th th:text="#{msg.user-detail.accountNonLocked}">Cuenta No Bloqueada</th>
                <td th:text="${user.accountNonLocked} ? 'Sí' : 'No'"></td>
            </tr>
            <tr>
                <th th:text="#{msg.user-detail.emailVerified}">Email Verificado</th>
                <td th:text="${user.emailVerified} ? 'Sí' : 'No'"></td>
            </tr>
            <tr>
                <th th:text="#{msg.user-detail.mustChangePassword}">Debe Cambiar Contraseña</th>
                <td th:text="${user.mustChangePassword} ? 'Sí' : 'No'"></td>
            </tr>
            <tr>
                <th th:text="#{msg.user-detail.lastPasswordChange}">Último Cambio de Contraseña</th>
                <td th:text="${user.lastPasswordChange}"></td>
            </tr>
            <tr>
                <th th:text="#{msg.user-detail.passwordExpiresAt}">Contraseña Expira En</th>
                <td th:text="${user.passwordExpiresAt}"></td>
            </tr>
            <tr>
                <th th:text="#{msg.user-detail.failedLoginAttempts}">Intentos Fallidos</th>
                <td th:text="${user.failedLoginAttempts}"></td>
            </tr>
            </tbody>
        </table>

        <!-- Botones de acción -->
        <div class="mt-3">
            <a th:href="@{/users/edit(id=${user.id})}" class="btn btn-primary me-2" th:text="#{msg.user-detail.edit}">
                Editar
            </a>

            <form th:action="@{/users/delete}" method="post" class="d-inline">
                <input type="hidden" name="id" th:value="${user.id}"/>
                <button type="submit" class="btn btn-danger"
                        th:onclick="|return confirm('#{msg.user-detail.confirmDelete}');|"
                        th:text="#{msg.user-detail.delete}">
                    Eliminar
                </button>
            </form>

            <a th:href="@{/users}" class="btn btn-secondary ms-2" th:text="#{msg.user-detail.returnback}">
                Volver a la lista
            </a>
        </div>
        <div class="mt-4">
            <h2 class="h5" th:text="#{msg.user-detail.section.profileData}">Perfil de usuario</h2>

            <!-- Si no hay datos de perfil (todos los campos de perfil son null) -->
            <div th:if="${user.firstName == null and user.lastName == null and user.phoneNumber == null and user.profileImage == null and user.bio == null and user.locale == null}" class="alert alert-info">
                Este usuario no tiene perfil asociado.
            </div>


            <!-- Si hay algún dato de perfil -->
            <div th:if="${user.firstName != null or user.lastName != null or user.phoneNumber != null or user.profileImage != null or user.bio != null or user.locale != null}">
                <dl class="row">

                    <dt class="col-sm-3" th:text="#{msg.user-detail.profile.field.firstName}"></dt>
                    <dd class="col-sm-9" th:text="${user.firstName}"></dd>

                    <dt class="col-sm-3" th:text="#{msg.user-detail.profile.field.lastName}"></dt>
                    <dd class="col-sm-9" th:text="${user.lastName}"></dd>

                    <dt class="col-sm-3" th:text="#{msg.user-detail.profile.field.roles}">Roles</dt>
                    <dd class="col-sm-9">
                        <ul class="mb-0"
                            th:if="${user.roles != null and !#lists.isEmpty(user.roles)}">
                            <li th:each="roleName : ${user.roles}"
                                th:text="${roleName}">
                                ROLE_X
                            </li>
                        </ul>

                        <span class="text-muted"
                              th:if="${user.roles == null or #lists.isEmpty(user.roles)}"
                              th:text="#{msg.user-detail.field.roles.empty}">
                                This user has no roles assigned.
                        </span>
                    </dd>
                    <dt class="col-sm-3" th:text="#{msg.user-detail.profile.field.phoneNumber}"></dt>
                    <dd class="col-sm-9" th:text="${user.phoneNumber}"></dd>

                    <dt class="col-sm-3" th:text="#{msg.user-detail.profile.field.locale}"></dt>
                    <dd class="col-sm-9" th:text="${user.locale}"></dd>

                    <dt class="col-sm-3" th:text="#{msg.user-detail.profile.field.profileImage}"></dt>
                    <dd class="col-sm-9">
                        <div th:if="${user.profileImage == null}">
                            <span class="text-muted" th:text="#{msg.user-detail.profile.noImage}"></span>
                        </div>

                        <div th:if="${user.profileImage != null}">
                            <img th:src="${user.profileImage}" alt="Foto perfil" class="img-thumbnail rounded"
                                 style="max-width: 150px;"/>
                        </div>
                    </dd>
                </dl>
            </div>
        </div>

    </div>
</main>

<!-- Insertar el fragmento del footer -->
<footer th:replace="fragments/footer :: footer"></footer>

<div th:replace="fragments/scripts :: scripts"></div>

</body>
</html>
