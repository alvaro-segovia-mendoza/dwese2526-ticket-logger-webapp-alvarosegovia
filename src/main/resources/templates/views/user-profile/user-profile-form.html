<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head('Ticket Logger - User Profile Form')">
    <!-- Fragmento head reutilizable con título dinámico para la página -->
</head>

<body class="d-flex flex-column min-vh-100 bg-light">

<div class="content-wrapper">

    <!-- ───────────── HEADER ───────────── -->
    <header th:replace="fragments/header :: header"></header>
    <!-- Inserta el header común del sitio -->

    <!-- ───────────── MAIN ───────────── -->
    <main class="form-page">
        <div class="form-card">

            <!-- Avatar del usuario -->
            <div class="text-center mb-3">
                <img th:src="${userProfileForm.profileImage != null} ? ${userProfileForm.profileImage} : @{/images/avatar.svg}"
                     class="img-thumbnail rounded" style="max-width: 150px;">
            </div>

            <!-- Título y subtítulo de la sección -->
            <h1 th:text="#{msg.userProfile.title}"></h1>
            <p class="text-muted" th:text="#{msg.userProfile.subtitle}"></p>

            <!-- Mensajes de éxito y error -->
            <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
            <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

            <!-- ───────────── FORMULARIO ───────────── -->
            <form th:action="@{/profile/update}"
                  th:object="${userProfileForm}"
                  enctype="multipart/form-data"
                  method="post"
                  class="mt-3">

                <!-- ID oculto para identificar al usuario -->
                <input type="hidden" th:field="*{userId}"/>

                <!-- Campos del formulario -->

                <!-- Subida de imagen de perfil -->
                <div class="mb-3">
                    <label for="profileImageFile" class="form-label"
                           th:text="#{msg.userProfile.field.profileImageUpload}"></label>
                    <input type="file"
                           id="profileImageFile"
                           name="profileImageFile"
                           class="form-control"
                           accept="image/*" />
                    <small class="form-text text-muted" th:text="#{msg.userProfile.field.profileImageUpload.help}"></small>
                    <div th:if="${#fields.hasErrors('profileImage')}" class="text-danger" th:errors="*{profileImage}"></div>
                </div>

                <!-- Email (solo lectura) -->
                <div class="mb-3">
                    <label for="email" class="form-label" th:text="#{msg.userProfile.field.email}"></label>
                    <input type="text" id="email" th:field="*{email}" class="form-control" readonly>
                    <div th:if="${#fields.hasErrors('email')}" class="text-danger" th:errors="*{email}"></div>
                </div>

                <!-- Nombre -->
                <div class="mb-3">
                    <label for="firstName" class="form-label" th:text="#{msg.userProfile.field.firstName}"></label>
                    <input type="text" id="firstName" th:field="*{firstName}" class="form-control" />
                    <div th:if="${#fields.hasErrors('firstName')}" class="text-danger" th:errors="*{firstName}"></div>
                </div>

                <!-- Apellido -->
                <div class="mb-3">
                    <label for="lastName" class="form-label" th:text="#{msg.userProfile.field.lastName}"></label>
                    <input type="text" id="lastName" th:field="*{lastName}" class="form-control" />
                    <div th:if="${#fields.hasErrors('lastName')}" class="text-danger" th:errors="*{lastName}"></div>
                </div>

                <!-- Teléfono -->
                <div class="mb-3">
                    <label for="phoneNumber" class="form-label" th:text="#{msg.userProfile.field.phoneNumber}"></label>
                    <input type="text" id="phoneNumber" th:field="*{phoneNumber}" class="form-control" />
                    <div th:if="${#fields.hasErrors('phoneNumber')}" class="text-danger" th:errors="*{phoneNumber}"></div>
                </div>

                <!-- URL de imagen -->
                <div class="mb-3">
                    <label for="profileImage" class="form-label" th:text="#{msg.userProfile.field.profileImage}"></label>
                    <input type="text" id="profileImage" th:field="*{profileImage}" class="form-control" />
                    <div th:if="${#fields.hasErrors('profileImage')}" class="text-danger" th:errors="*{profileImage}"></div>
                </div>

                <!-- Biografía -->
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <label for="bio" class="form-label mb-0" th:text="#{msg.userProfile.field.bio}"></label>


                        <button type="submit"
                                th:formaction="@{/profile/generate-bio}"
                                class="btn btn-sm btn-outline-secondary">
                            ✨ <span th:text="#{msg.userProfile.action.generateBio}">Generar con IA</span>
                        </button>
                    </div>
                    <textarea id="bio" th:field="*{bio}" rows="3" class="form-control"></textarea>
                    <div th:if="${#fields.hasErrors('bio')}" class="text-danger" th:errors="*{bio}"></div>
                </div>

                <!-- Localización/idioma -->
                <div class="mb-3">
                    <label for="locale" class="form-label" th:text="#{msg.userProfile.field.locale}"></label>
                    <input type="text" id="locale" th:field="*{locale}" class="form-control" />
                    <div th:if="${#fields.hasErrors('locale')}" class="text-danger" th:errors="*{locale}"></div>
                </div>

                <!-- Botones de acción -->
                <button type="submit" class="btn btn-primary" th:text="#{msg.userProfile.action.save}"></button>
                <a th:href="@{/}" class="btn btn-secondary mt-2" th:text="#{msg.userProfile.action.back}"></a>

            </form>
        </div>
    </main>
</div>

<!-- ───────────── FOOTER Y SCRIPTS ───────────── -->
<footer th:replace="fragments/footer :: footer"></footer>
<div th:replace="fragments/scripts :: scripts"></div>

</body>
</html>
